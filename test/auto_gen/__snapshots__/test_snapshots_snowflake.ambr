# serializer version: 1
# name: test_generated_files_snowflake
  dict({
    'ecommerce_transaction_interactions_features_1/configs/base_config.json': '''
      {
          "events": [
              "iglu:com.snowplowanalytics.snowplow/page_view/jsonschema/1-0-0",
              "iglu:com.snowplowanalytics.snowplow/page_ping/jsonschema/1-0-0",
              "iglu:com.snowplowanalytics.snowplow.media/ad_break_end_event/jsonschema/1-0-0",
              "iglu:com.snowplowanalytics.snowplow.media/ad_break_start_event/jsonschema/1-0-0",
              "iglu:com.snowplowanalytics.snowplow.media/ad_complete_event/jsonschema/1-0-0",
              "iglu:com.snowplowanalytics.snowplow.media/ad_quartile_event/jsonschema/1-0-0",
              "iglu:com.snowplowanalytics.snowplow.media/ad_skip_event/jsonschema/1-0-0",
              "iglu:com.snowplowanalytics.snowplow.media/ad_start_event/jsonschema/1-0-0",
              "iglu:com.snowplowanalytics.snowplow.media/buffer_end_event/jsonschema/1-0-0",
              "iglu:com.snowplowanalytics.snowplow.media/buffer_start_event/jsonschema/1-0-0",
              "iglu:com.snowplowanalytics.snowplow.media/end_event/jsonschema/1-0-0",
              "iglu:com.snowplowanalytics.snowplow.media/pause_event/jsonschema/1-0-0",
              "iglu:com.snowplowanalytics.snowplow.media/percent_progress_event/jsonschema/1-0-0",
              "iglu:com.snowplowanalytics.snowplow.media/ping_event/jsonschema/1-0-0",
              "iglu:com.snowplowanalytics.snowplow.media/play_event/jsonschema/1-0-0",
              "iglu:com.snowplowanalytics.snowplow.media/playback_rate_change_event/jsonschema/1-0-0",
              "iglu:com.snowplowanalytics.snowplow.media/quality_change_event/jsonschema/1-0-0",
              "iglu:com.snowplowanalytics.snowplow.media/ready_event/jsonschema/1-0-0",
              "iglu:com.snowplowanalytics.snowplow.media/seek_end_event/jsonschema/1-0-0",
              "iglu:com.snowplowanalytics.snowplow.media/seek_start_event/jsonschema/1-0-0",
              "iglu:com.snowplowanalytics.snowplow.media/volume_change_event/jsonschema/1-0-0",
              "iglu:com.snowplowanalytics.snowplow/change_form/jsonschema/1-0-0",
              "iglu:com.snowplowanalytics.snowplow/focus_form/jsonschema/1-0-0",
              "iglu:com.snowplowanalytics.snowplow.ecommerce/snowplow_ecommerce_action/jsonschema/1-0-0"
          ],
          "properties": [
              {
                  "geo_country": "geo_country"
              },
              {
                  "geo_timezone": "geo_timezone"
              },
              {
                  "contexts_nl_basjes_yauaa_context_1[0]:operatingSystemName": "operating_system_name"
              },
              {
                  "contexts_nl_basjes_yauaa_context_1[0]:deviceClass": "device_class"
              },
              {
                  "mkt_source": "mkt_source"
              },
              {
                  "mkt_medium": "mkt_medium"
              },
              {
                  "refr_source": "refr_source"
              },
              {
                  "refr_medium": "refr_medium"
              },
              {
                  "page_url": "page_url"
              },
              {
                  "contexts_com_snowplowanalytics_snowplow_ecommerce_transaction_1[0]:revenue": "revenue"
              }
          ],
          "periods": [
              "P7DT0H0M0.000000S",
              "P1DT0H0M0.000000S"
          ],
          "transformed_attributes": [
              [
                  {
                      "step_type": "filtered_events",
                      "enabled": false,
                      "aggregation": null,
                      "column_name": null,
                      "modeling_criteria": null
                  },
                  {
                      "step_type": "daily_aggregation",
                      "enabled": true,
                      "aggregation": "count",
                      "column_name": "count_page_view",
                      "modeling_criteria": {
                          "all": [
                              {
                                  "property": "event_name",
                                  "operator": "in",
                                  "value": "'page_view'"
                              }
                          ],
                          "any": []
                      }
                  },
                  {
                      "step_type": "attribute_aggregation",
                      "enabled": true,
                      "aggregation": "sum",
                      "column_name": "page_view_events_count_last_7_days",
                      "modeling_criteria": {
                          "all": [
                              {
                                  "property": "period",
                                  "operator": ">",
                                  "value": 7
                              }
                          ],
                          "any": []
                      }
                  }
              ],
              [
                  {
                      "step_type": "filtered_events",
                      "enabled": false,
                      "aggregation": null,
                      "column_name": null,
                      "modeling_criteria": null
                  },
                  {
                      "step_type": "daily_aggregation",
                      "enabled": true,
                      "aggregation": "count",
                      "column_name": "count_page_ping",
                      "modeling_criteria": {
                          "all": [
                              {
                                  "property": "event_name",
                                  "operator": "in",
                                  "value": "'page_ping'"
                              }
                          ],
                          "any": []
                      }
                  },
                  {
                      "step_type": "attribute_aggregation",
                      "enabled": true,
                      "aggregation": "sum",
                      "column_name": "page_ping_events_count_last_7_days",
                      "modeling_criteria": {
                          "all": [
                              {
                                  "property": "period",
                                  "operator": ">",
                                  "value": 7
                              }
                          ],
                          "any": []
                      }
                  }
              ],
              [
                  {
                      "step_type": "filtered_events",
                      "enabled": false,
                      "aggregation": null,
                      "column_name": "geo_country",
                      "modeling_criteria": null
                  },
                  {
                      "step_type": "daily_aggregation",
                      "enabled": true,
                      "aggregation": "last",
                      "column_name": "last_geo_country",
                      "modeling_criteria": {
                          "all": [
                              {
                                  "property": "event_name",
                                  "operator": "in",
                                  "value": "'page_view'"
                              }
                          ],
                          "any": []
                      }
                  },
                  {
                      "step_type": "attribute_aggregation",
                      "enabled": true,
                      "aggregation": "last",
                      "column_name": "last_geo_country",
                      "modeling_criteria": {
                          "all": [],
                          "any": []
                      }
                  }
              ],
              [
                  {
                      "step_type": "filtered_events",
                      "enabled": false,
                      "aggregation": null,
                      "column_name": "geo_timezone",
                      "modeling_criteria": null
                  },
                  {
                      "step_type": "daily_aggregation",
                      "enabled": true,
                      "aggregation": "last",
                      "column_name": "last_geo_timezone",
                      "modeling_criteria": {
                          "all": [
                              {
                                  "property": "event_name",
                                  "operator": "in",
                                  "value": "'page_view'"
                              }
                          ],
                          "any": []
                      }
                  },
                  {
                      "step_type": "attribute_aggregation",
                      "enabled": true,
                      "aggregation": "last",
                      "column_name": "last_timezone",
                      "modeling_criteria": {
                          "all": [],
                          "any": []
                      }
                  }
              ],
              [
                  {
                      "step_type": "filtered_events",
                      "enabled": false,
                      "aggregation": null,
                      "column_name": "operating_system_name",
                      "modeling_criteria": null
                  },
                  {
                      "step_type": "daily_aggregation",
                      "enabled": true,
                      "aggregation": "last",
                      "column_name": "last_operating_system_name",
                      "modeling_criteria": {
                          "all": [
                              {
                                  "property": "event_name",
                                  "operator": "in",
                                  "value": "'page_view'"
                              }
                          ],
                          "any": []
                      }
                  },
                  {
                      "step_type": "attribute_aggregation",
                      "enabled": true,
                      "aggregation": "last",
                      "column_name": "last_os",
                      "modeling_criteria": {
                          "all": [],
                          "any": []
                      }
                  }
              ],
              [
                  {
                      "step_type": "filtered_events",
                      "enabled": false,
                      "aggregation": null,
                      "column_name": "device_class",
                      "modeling_criteria": null
                  },
                  {
                      "step_type": "daily_aggregation",
                      "enabled": true,
                      "aggregation": "last",
                      "column_name": "last_device_class",
                      "modeling_criteria": {
                          "all": [
                              {
                                  "property": "event_name",
                                  "operator": "in",
                                  "value": "'page_view'"
                              }
                          ],
                          "any": []
                      }
                  },
                  {
                      "step_type": "attribute_aggregation",
                      "enabled": true,
                      "aggregation": "last",
                      "column_name": "last_device_class",
                      "modeling_criteria": {
                          "all": [],
                          "any": []
                      }
                  }
              ],
              [
                  {
                      "step_type": "filtered_events",
                      "enabled": false,
                      "aggregation": null,
                      "column_name": "mkt_source",
                      "modeling_criteria": null
                  },
                  {
                      "step_type": "daily_aggregation",
                      "enabled": true,
                      "aggregation": "first",
                      "column_name": "first_mkt_source",
                      "modeling_criteria": {
                          "all": [
                              {
                                  "property": "event_name",
                                  "operator": "in",
                                  "value": "'page_view'"
                              }
                          ],
                          "any": []
                      }
                  },
                  {
                      "step_type": "attribute_aggregation",
                      "enabled": true,
                      "aggregation": "first",
                      "column_name": "first_mkt_source",
                      "modeling_criteria": {
                          "all": [],
                          "any": []
                      }
                  }
              ],
              [
                  {
                      "step_type": "filtered_events",
                      "enabled": false,
                      "aggregation": null,
                      "column_name": "mkt_medium",
                      "modeling_criteria": null
                  },
                  {
                      "step_type": "daily_aggregation",
                      "enabled": true,
                      "aggregation": "first",
                      "column_name": "first_mkt_medium",
                      "modeling_criteria": {
                          "all": [
                              {
                                  "property": "event_name",
                                  "operator": "in",
                                  "value": "'page_view'"
                              }
                          ],
                          "any": []
                      }
                  },
                  {
                      "step_type": "attribute_aggregation",
                      "enabled": true,
                      "aggregation": "first",
                      "column_name": "first_mkt_medium",
                      "modeling_criteria": {
                          "all": [],
                          "any": []
                      }
                  }
              ],
              [
                  {
                      "step_type": "filtered_events",
                      "enabled": false,
                      "aggregation": null,
                      "column_name": "mkt_source",
                      "modeling_criteria": null
                  },
                  {
                      "step_type": "daily_aggregation",
                      "enabled": true,
                      "aggregation": "last",
                      "column_name": "last_mkt_source",
                      "modeling_criteria": {
                          "all": [
                              {
                                  "property": "event_name",
                                  "operator": "in",
                                  "value": "'page_view'"
                              }
                          ],
                          "any": []
                      }
                  },
                  {
                      "step_type": "attribute_aggregation",
                      "enabled": true,
                      "aggregation": "last",
                      "column_name": "last_mkt_source",
                      "modeling_criteria": {
                          "all": [],
                          "any": []
                      }
                  }
              ],
              [
                  {
                      "step_type": "filtered_events",
                      "enabled": false,
                      "aggregation": null,
                      "column_name": "mkt_medium",
                      "modeling_criteria": null
                  },
                  {
                      "step_type": "daily_aggregation",
                      "enabled": true,
                      "aggregation": "last",
                      "column_name": "last_mkt_medium",
                      "modeling_criteria": {
                          "all": [
                              {
                                  "property": "event_name",
                                  "operator": "in",
                                  "value": "'page_view'"
                              }
                          ],
                          "any": []
                      }
                  },
                  {
                      "step_type": "attribute_aggregation",
                      "enabled": true,
                      "aggregation": "last",
                      "column_name": "last_mkt_medium",
                      "modeling_criteria": {
                          "all": [],
                          "any": []
                      }
                  }
              ],
              [
                  {
                      "step_type": "filtered_events",
                      "enabled": false,
                      "aggregation": null,
                      "column_name": "refr_source",
                      "modeling_criteria": null
                  },
                  {
                      "step_type": "daily_aggregation",
                      "enabled": true,
                      "aggregation": "first",
                      "column_name": "first_refr_source",
                      "modeling_criteria": {
                          "all": [
                              {
                                  "property": "event_name",
                                  "operator": "in",
                                  "value": "'page_view'"
                              }
                          ],
                          "any": []
                      }
                  },
                  {
                      "step_type": "attribute_aggregation",
                      "enabled": true,
                      "aggregation": "first",
                      "column_name": "first_referrer_source",
                      "modeling_criteria": {
                          "all": [],
                          "any": []
                      }
                  }
              ],
              [
                  {
                      "step_type": "filtered_events",
                      "enabled": false,
                      "aggregation": null,
                      "column_name": "refr_medium",
                      "modeling_criteria": null
                  },
                  {
                      "step_type": "daily_aggregation",
                      "enabled": true,
                      "aggregation": "first",
                      "column_name": "first_refr_medium",
                      "modeling_criteria": {
                          "all": [
                              {
                                  "property": "event_name",
                                  "operator": "in",
                                  "value": "'page_view'"
                              }
                          ],
                          "any": []
                      }
                  },
                  {
                      "step_type": "attribute_aggregation",
                      "enabled": true,
                      "aggregation": "first",
                      "column_name": "first_referrer_medium",
                      "modeling_criteria": {
                          "all": [],
                          "any": []
                      }
                  }
              ],
              [
                  {
                      "step_type": "filtered_events",
                      "enabled": false,
                      "aggregation": null,
                      "column_name": null,
                      "modeling_criteria": null
                  },
                  {
                      "step_type": "daily_aggregation",
                      "enabled": true,
                      "aggregation": "count",
                      "column_name": "count_page_view_page_url_like_pctpricingpct",
                      "modeling_criteria": {
                          "all": [
                              {
                                  "property": "event_name",
                                  "operator": "in",
                                  "value": "'page_view'"
                              },
                              {
                                  "property": "page_url",
                                  "operator": "like",
                                  "value": "%pricing%"
                              }
                          ],
                          "any": []
                      }
                  },
                  {
                      "step_type": "attribute_aggregation",
                      "enabled": true,
                      "aggregation": "sum",
                      "column_name": "pricing_pageview_count_last_7_days",
                      "modeling_criteria": {
                          "all": [
                              {
                                  "property": "period",
                                  "operator": ">",
                                  "value": 7
                              }
                          ],
                          "any": []
                      }
                  }
              ],
              [
                  {
                      "step_type": "filtered_events",
                      "enabled": false,
                      "aggregation": null,
                      "column_name": null,
                      "modeling_criteria": null
                  },
                  {
                      "step_type": "daily_aggregation",
                      "enabled": true,
                      "aggregation": "count",
                      "column_name": "count_page_view_page_url_like_pctdemopct",
                      "modeling_criteria": {
                          "all": [
                              {
                                  "property": "event_name",
                                  "operator": "in",
                                  "value": "'page_view'"
                              },
                              {
                                  "property": "page_url",
                                  "operator": "like",
                                  "value": "%demo%"
                              }
                          ],
                          "any": []
                      }
                  },
                  {
                      "step_type": "attribute_aggregation",
                      "enabled": true,
                      "aggregation": "sum",
                      "column_name": "demo_pageview_count_last_7_days",
                      "modeling_criteria": {
                          "all": [
                              {
                                  "property": "period",
                                  "operator": ">",
                                  "value": 7
                              }
                          ],
                          "any": []
                      }
                  }
              ],
              [
                  {
                      "step_type": "filtered_events",
                      "enabled": false,
                      "aggregation": null,
                      "column_name": null,
                      "modeling_criteria": null
                  },
                  {
                      "step_type": "daily_aggregation",
                      "enabled": true,
                      "aggregation": "count",
                      "column_name": "media_video_event_count_last_7_days",
                      "modeling_criteria": {
                          "all": [
                              {
                                  "property": "event_name",
                                  "operator": "in",
                                  "value": "'quality_change_event','pause_event','volume_change_event','percent_progress_event','ad_quartile_event','ping_event','seek_start_event','seek_end_event','end_event','ad_start_event','play_event','ready_event','playback_rate_change_event','ad_break_start_event','ad_complete_event','ad_skip_event','buffer_start_event','buffer_end_event','ad_break_end_event'"
                              }
                          ],
                          "any": []
                      }
                  },
                  {
                      "step_type": "attribute_aggregation",
                      "enabled": true,
                      "aggregation": "sum",
                      "column_name": "media_video_event_count_last_7_days",
                      "modeling_criteria": {
                          "all": [
                              {
                                  "property": "period",
                                  "operator": ">",
                                  "value": 7
                              }
                          ],
                          "any": []
                      }
                  }
              ],
              [
                  {
                      "step_type": "filtered_events",
                      "enabled": false,
                      "aggregation": null,
                      "column_name": null,
                      "modeling_criteria": null
                  },
                  {
                      "step_type": "daily_aggregation",
                      "enabled": true,
                      "aggregation": "count",
                      "column_name": "count_focus_form_change_form",
                      "modeling_criteria": {
                          "all": [
                              {
                                  "property": "event_name",
                                  "operator": "in",
                                  "value": "'focus_form','change_form'"
                              }
                          ],
                          "any": []
                      }
                  },
                  {
                      "step_type": "attribute_aggregation",
                      "enabled": true,
                      "aggregation": "sum",
                      "column_name": "form_focus_change_event_count_last_7_days",
                      "modeling_criteria": {
                          "all": [
                              {
                                  "property": "period",
                                  "operator": ">",
                                  "value": 7
                              }
                          ],
                          "any": []
                      }
                  }
              ],
              [
                  {
                      "step_type": "filtered_events",
                      "enabled": false,
                      "aggregation": null,
                      "column_name": "revenue",
                      "modeling_criteria": null
                  },
                  {
                      "step_type": "daily_aggregation",
                      "enabled": true,
                      "aggregation": "sum",
                      "column_name": "sum_revenue_snowplow_ecommerce_action",
                      "modeling_criteria": {
                          "all": [
                              {
                                  "property": "event_name",
                                  "operator": "in",
                                  "value": "'snowplow_ecommerce_action'"
                              }
                          ],
                          "any": []
                      }
                  },
                  {
                      "step_type": "attribute_aggregation",
                      "enabled": true,
                      "aggregation": "sum",
                      "column_name": "total_revenue_last_7_days",
                      "modeling_criteria": {
                          "all": [
                              {
                                  "property": "period",
                                  "operator": ">",
                                  "value": 7
                              }
                          ],
                          "any": []
                      }
                  }
              ],
              [
                  {
                      "step_type": "filtered_events",
                      "enabled": false,
                      "aggregation": null,
                      "column_name": "operating_system_name",
                      "modeling_criteria": null
                  },
                  {
                      "step_type": "daily_aggregation",
                      "enabled": true,
                      "aggregation": "unique_list",
                      "column_name": "op_systems",
                      "modeling_criteria": {
                          "all": [
                              {
                                  "property": "event_name",
                                  "operator": "in",
                                  "value": "'page_view','page_ping','snowplow_ecommerce_action'"
                              },
                              {
                                  "property": "revenue",
                                  "operator": "!=",
                                  "value": 1
                              }
                          ],
                          "any": []
                      }
                  },
                  {
                      "step_type": "attribute_aggregation",
                      "enabled": true,
                      "aggregation": "unique_list",
                      "column_name": "op_systems",
                      "modeling_criteria": {
                          "all": [],
                          "any": []
                      }
                  }
              ],
              [
                  {
                      "step_type": "filtered_events",
                      "enabled": false,
                      "aggregation": null,
                      "column_name": "operating_system_name",
                      "modeling_criteria": null
                  },
                  {
                      "step_type": "daily_aggregation",
                      "enabled": true,
                      "aggregation": "unique_list",
                      "column_name": "op_systems_2",
                      "modeling_criteria": {
                          "all": [
                              {
                                  "property": "event_name",
                                  "operator": "in",
                                  "value": "'page_view','page_ping','snowplow_ecommerce_action'"
                              },
                              {
                                  "property": "revenue",
                                  "operator": "!=",
                                  "value": 1
                              }
                          ],
                          "any": []
                      }
                  },
                  {
                      "step_type": "attribute_aggregation",
                      "enabled": true,
                      "aggregation": "unique_list",
                      "column_name": "op_systems_2",
                      "modeling_criteria": {
                          "all": [
                              {
                                  "property": "period",
                                  "operator": ">",
                                  "value": 1
                              }
                          ],
                          "any": []
                      }
                  }
              ]
          ],
          "entity_key": "domain_userid"
      }
    ''',
    'ecommerce_transaction_interactions_features_1/configs/batch_source_config.json': '''
      {
          "database": "",
          "wh_schema": "",
          "table": "ecommerce_transaction_interactions_features_1_attributes",
          "name": "ecommerce_transaction_interactions_features_1_attributes",
          "timestamp_field": "valid_at_tstamp",
          "created_timestamp_column": "lower_limit",
          "description": "Table containing attributes for ecommerce_transaction_interactions_features_1 view",
          "tags": {},
          "owner": ""
      }
    ''',
    'ecommerce_transaction_interactions_features_1/configs/dbt_config.json': '''
      {
          "filtered_events": {
              "events": [
                  {
                      "event_vendor": "com.snowplowanalytics.snowplow",
                      "event_name": "page_view",
                      "event_format": "jsonschema",
                      "event_version": "1-0-0"
                  },
                  {
                      "event_vendor": "com.snowplowanalytics.snowplow",
                      "event_name": "page_ping",
                      "event_format": "jsonschema",
                      "event_version": "1-0-0"
                  },
                  {
                      "event_vendor": "com.snowplowanalytics.snowplow.media",
                      "event_name": "ad_break_end_event",
                      "event_format": "jsonschema",
                      "event_version": "1-0-0"
                  },
                  {
                      "event_vendor": "com.snowplowanalytics.snowplow.media",
                      "event_name": "ad_break_start_event",
                      "event_format": "jsonschema",
                      "event_version": "1-0-0"
                  },
                  {
                      "event_vendor": "com.snowplowanalytics.snowplow.media",
                      "event_name": "ad_complete_event",
                      "event_format": "jsonschema",
                      "event_version": "1-0-0"
                  },
                  {
                      "event_vendor": "com.snowplowanalytics.snowplow.media",
                      "event_name": "ad_quartile_event",
                      "event_format": "jsonschema",
                      "event_version": "1-0-0"
                  },
                  {
                      "event_vendor": "com.snowplowanalytics.snowplow.media",
                      "event_name": "ad_skip_event",
                      "event_format": "jsonschema",
                      "event_version": "1-0-0"
                  },
                  {
                      "event_vendor": "com.snowplowanalytics.snowplow.media",
                      "event_name": "ad_start_event",
                      "event_format": "jsonschema",
                      "event_version": "1-0-0"
                  },
                  {
                      "event_vendor": "com.snowplowanalytics.snowplow.media",
                      "event_name": "buffer_end_event",
                      "event_format": "jsonschema",
                      "event_version": "1-0-0"
                  },
                  {
                      "event_vendor": "com.snowplowanalytics.snowplow.media",
                      "event_name": "buffer_start_event",
                      "event_format": "jsonschema",
                      "event_version": "1-0-0"
                  },
                  {
                      "event_vendor": "com.snowplowanalytics.snowplow.media",
                      "event_name": "end_event",
                      "event_format": "jsonschema",
                      "event_version": "1-0-0"
                  },
                  {
                      "event_vendor": "com.snowplowanalytics.snowplow.media",
                      "event_name": "pause_event",
                      "event_format": "jsonschema",
                      "event_version": "1-0-0"
                  },
                  {
                      "event_vendor": "com.snowplowanalytics.snowplow.media",
                      "event_name": "percent_progress_event",
                      "event_format": "jsonschema",
                      "event_version": "1-0-0"
                  },
                  {
                      "event_vendor": "com.snowplowanalytics.snowplow.media",
                      "event_name": "ping_event",
                      "event_format": "jsonschema",
                      "event_version": "1-0-0"
                  },
                  {
                      "event_vendor": "com.snowplowanalytics.snowplow.media",
                      "event_name": "play_event",
                      "event_format": "jsonschema",
                      "event_version": "1-0-0"
                  },
                  {
                      "event_vendor": "com.snowplowanalytics.snowplow.media",
                      "event_name": "playback_rate_change_event",
                      "event_format": "jsonschema",
                      "event_version": "1-0-0"
                  },
                  {
                      "event_vendor": "com.snowplowanalytics.snowplow.media",
                      "event_name": "quality_change_event",
                      "event_format": "jsonschema",
                      "event_version": "1-0-0"
                  },
                  {
                      "event_vendor": "com.snowplowanalytics.snowplow.media",
                      "event_name": "ready_event",
                      "event_format": "jsonschema",
                      "event_version": "1-0-0"
                  },
                  {
                      "event_vendor": "com.snowplowanalytics.snowplow.media",
                      "event_name": "seek_end_event",
                      "event_format": "jsonschema",
                      "event_version": "1-0-0"
                  },
                  {
                      "event_vendor": "com.snowplowanalytics.snowplow.media",
                      "event_name": "seek_start_event",
                      "event_format": "jsonschema",
                      "event_version": "1-0-0"
                  },
                  {
                      "event_vendor": "com.snowplowanalytics.snowplow.media",
                      "event_name": "volume_change_event",
                      "event_format": "jsonschema",
                      "event_version": "1-0-0"
                  },
                  {
                      "event_vendor": "com.snowplowanalytics.snowplow",
                      "event_name": "change_form",
                      "event_format": "jsonschema",
                      "event_version": "1-0-0"
                  },
                  {
                      "event_vendor": "com.snowplowanalytics.snowplow",
                      "event_name": "focus_form",
                      "event_format": "jsonschema",
                      "event_version": "1-0-0"
                  },
                  {
                      "event_vendor": "com.snowplowanalytics.snowplow.ecommerce",
                      "event_name": "snowplow_ecommerce_action",
                      "event_format": "jsonschema",
                      "event_version": "1-0-0"
                  }
              ],
              "properties": [
                  {
                      "type": "direct",
                      "full_path": "geo_country",
                      "alias": "geo_country",
                      "column_prefix": null
                  },
                  {
                      "type": "direct",
                      "full_path": "geo_timezone",
                      "alias": "geo_timezone",
                      "column_prefix": null
                  },
                  {
                      "type": "direct",
                      "full_path": "contexts_nl_basjes_yauaa_context_1[0]:operatingSystemName",
                      "alias": "operating_system_name",
                      "column_prefix": null
                  },
                  {
                      "type": "direct",
                      "full_path": "contexts_nl_basjes_yauaa_context_1[0]:deviceClass",
                      "alias": "device_class",
                      "column_prefix": null
                  },
                  {
                      "type": "direct",
                      "full_path": "mkt_source",
                      "alias": "mkt_source",
                      "column_prefix": null
                  },
                  {
                      "type": "direct",
                      "full_path": "mkt_medium",
                      "alias": "mkt_medium",
                      "column_prefix": null
                  },
                  {
                      "type": "direct",
                      "full_path": "refr_source",
                      "alias": "refr_source",
                      "column_prefix": null
                  },
                  {
                      "type": "direct",
                      "full_path": "refr_medium",
                      "alias": "refr_medium",
                      "column_prefix": null
                  },
                  {
                      "type": "direct",
                      "full_path": "page_url",
                      "alias": "page_url",
                      "column_prefix": null
                  },
                  {
                      "type": "direct",
                      "full_path": "contexts_com_snowplowanalytics_snowplow_ecommerce_transaction_1[0]:revenue",
                      "alias": "revenue",
                      "column_prefix": null
                  }
              ]
          },
          "daily_agg": {
              "daily_aggregate_attributes": [
                  {
                      "step_type": "daily_aggregation",
                      "aggregation": "count",
                      "column_name": "count_page_view",
                      "condition_clause": "case when  event_name IN('page_view') then 1 else 0 end"
                  },
                  {
                      "step_type": "daily_aggregation",
                      "aggregation": "count",
                      "column_name": "count_page_ping",
                      "condition_clause": "case when  event_name IN('page_ping') then 1 else 0 end"
                  },
                  {
                      "step_type": "daily_aggregation",
                      "aggregation": "count",
                      "column_name": "count_page_view_page_url_like_pctpricingpct",
                      "condition_clause": "case when  event_name IN('page_view') and  page_url LIKE '%%pricing%%' then 1 else 0 end"
                  },
                  {
                      "step_type": "daily_aggregation",
                      "aggregation": "count",
                      "column_name": "count_page_view_page_url_like_pctdemopct",
                      "condition_clause": "case when  event_name IN('page_view') and  page_url LIKE '%%demo%%' then 1 else 0 end"
                  },
                  {
                      "step_type": "daily_aggregation",
                      "aggregation": "count",
                      "column_name": "media_video_event_count_last_7_days",
                      "condition_clause": "case when  event_name IN('quality_change_event','pause_event','volume_change_event','percent_progress_event','ad_quartile_event','ping_event','seek_start_event','seek_end_event','end_event','ad_start_event','play_event','ready_event','playback_rate_change_event','ad_break_start_event','ad_complete_event','ad_skip_event','buffer_start_event','buffer_end_event','ad_break_end_event') then 1 else 0 end"
                  },
                  {
                      "step_type": "daily_aggregation",
                      "aggregation": "count",
                      "column_name": "count_focus_form_change_form",
                      "condition_clause": "case when  event_name IN('focus_form','change_form') then 1 else 0 end"
                  },
                  {
                      "step_type": "daily_aggregation",
                      "aggregation": "sum",
                      "column_name": "sum_revenue_snowplow_ecommerce_action",
                      "condition_clause": "case when  event_name IN('snowplow_ecommerce_action') then cast(revenue as {{ dbt.type_float()}}) else 0 end"
                  },
                  {
                      "step_type": "daily_aggregation",
                      "aggregation": "array_agg",
                      "column_name": "op_systems",
                      "condition_clause": "distinct case when  event_name IN('page_view','page_ping','snowplow_ecommerce_action') and  (revenue != 1 or revenue is null) then operating_system_name else null end"
                  },
                  {
                      "step_type": "daily_aggregation",
                      "aggregation": "array_agg",
                      "column_name": "op_systems_2",
                      "condition_clause": "distinct case when  event_name IN('page_view','page_ping','snowplow_ecommerce_action') and  (revenue != 1 or revenue is null) then operating_system_name else null end"
                  }
              ],
              "daily_first_value_attributes": [
                  {
                      "step_type": "daily_aggregation",
                      "aggregation": "first",
                      "column_name": "first_mkt_source",
                      "condition_clause": "mkt_source"
                  },
                  {
                      "step_type": "daily_aggregation",
                      "aggregation": "first",
                      "column_name": "first_mkt_medium",
                      "condition_clause": "mkt_medium"
                  },
                  {
                      "step_type": "daily_aggregation",
                      "aggregation": "first",
                      "column_name": "first_refr_source",
                      "condition_clause": "refr_source"
                  },
                  {
                      "step_type": "daily_aggregation",
                      "aggregation": "first",
                      "column_name": "first_refr_medium",
                      "condition_clause": "refr_medium"
                  }
              ],
              "daily_last_value_attributes": [
                  {
                      "step_type": "daily_aggregation",
                      "aggregation": "last",
                      "column_name": "last_geo_country",
                      "condition_clause": "geo_country"
                  },
                  {
                      "step_type": "daily_aggregation",
                      "aggregation": "last",
                      "column_name": "last_geo_timezone",
                      "condition_clause": "geo_timezone"
                  },
                  {
                      "step_type": "daily_aggregation",
                      "aggregation": "last",
                      "column_name": "last_operating_system_name",
                      "condition_clause": "operating_system_name"
                  },
                  {
                      "step_type": "daily_aggregation",
                      "aggregation": "last",
                      "column_name": "last_device_class",
                      "condition_clause": "device_class"
                  },
                  {
                      "step_type": "daily_aggregation",
                      "aggregation": "last",
                      "column_name": "last_mkt_source",
                      "condition_clause": "mkt_source"
                  },
                  {
                      "step_type": "daily_aggregation",
                      "aggregation": "last",
                      "column_name": "last_mkt_medium",
                      "condition_clause": "mkt_medium"
                  }
              ]
          },
          "attributes": {
              "lifetime_aggregates": [],
              "last_n_day_aggregates": [
                  {
                      "daily_agg_column_name": "count_page_view",
                      "column_name": "page_view_events_count_last_7_days",
                      "period": 7,
                      "aggregation_type": "sum"
                  },
                  {
                      "daily_agg_column_name": "count_page_ping",
                      "column_name": "page_ping_events_count_last_7_days",
                      "period": 7,
                      "aggregation_type": "sum"
                  },
                  {
                      "daily_agg_column_name": "count_page_view_page_url_like_pctpricingpct",
                      "column_name": "pricing_pageview_count_last_7_days",
                      "period": 7,
                      "aggregation_type": "sum"
                  },
                  {
                      "daily_agg_column_name": "count_page_view_page_url_like_pctdemopct",
                      "column_name": "demo_pageview_count_last_7_days",
                      "period": 7,
                      "aggregation_type": "sum"
                  },
                  {
                      "daily_agg_column_name": "media_video_event_count_last_7_days",
                      "column_name": "media_video_event_count_last_7_days",
                      "period": 7,
                      "aggregation_type": "sum"
                  },
                  {
                      "daily_agg_column_name": "count_focus_form_change_form",
                      "column_name": "form_focus_change_event_count_last_7_days",
                      "period": 7,
                      "aggregation_type": "sum"
                  },
                  {
                      "daily_agg_column_name": "sum_revenue_snowplow_ecommerce_action",
                      "column_name": "total_revenue_last_7_days",
                      "period": 7,
                      "aggregation_type": "sum"
                  }
              ],
              "first_value_attributes": [
                  {
                      "daily_agg_column_name": "first_mkt_source",
                      "column_name": "first_mkt_source",
                      "period": null,
                      "aggregation_type": "first"
                  },
                  {
                      "daily_agg_column_name": "first_mkt_medium",
                      "column_name": "first_mkt_medium",
                      "period": null,
                      "aggregation_type": "first"
                  },
                  {
                      "daily_agg_column_name": "first_refr_source",
                      "column_name": "first_referrer_source",
                      "period": null,
                      "aggregation_type": "first"
                  },
                  {
                      "daily_agg_column_name": "first_refr_medium",
                      "column_name": "first_referrer_medium",
                      "period": null,
                      "aggregation_type": "first"
                  }
              ],
              "last_value_attributes": [
                  {
                      "daily_agg_column_name": "last_geo_country",
                      "column_name": "last_geo_country",
                      "period": null,
                      "aggregation_type": "last"
                  },
                  {
                      "daily_agg_column_name": "last_geo_timezone",
                      "column_name": "last_timezone",
                      "period": null,
                      "aggregation_type": "last"
                  },
                  {
                      "daily_agg_column_name": "last_operating_system_name",
                      "column_name": "last_os",
                      "period": null,
                      "aggregation_type": "last"
                  },
                  {
                      "daily_agg_column_name": "last_device_class",
                      "column_name": "last_device_class",
                      "period": null,
                      "aggregation_type": "last"
                  },
                  {
                      "daily_agg_column_name": "last_mkt_source",
                      "column_name": "last_mkt_source",
                      "period": null,
                      "aggregation_type": "last"
                  },
                  {
                      "daily_agg_column_name": "last_mkt_medium",
                      "column_name": "last_mkt_medium",
                      "period": null,
                      "aggregation_type": "last"
                  }
              ],
              "unique_list_attributes": [
                  {
                      "daily_agg_column_name": "op_systems",
                      "column_name": "op_systems",
                      "period": null,
                      "aggregation_type": "array_agg"
                  },
                  {
                      "daily_agg_column_name": "op_systems_2",
                      "column_name": "op_systems_2",
                      "period": 1,
                      "aggregation_type": "array_agg"
                  }
              ]
          }
      }
    ''',
    'ecommerce_transaction_interactions_features_1/dbt_project.yml': '''
      name: 'ecommerce_transaction_interactions_features_1'
      version: '0.0.1'
      config-version: 2
      
      require-dbt-version: [">=1.6.0", "<2.0.0"]
      
      profile: 'snowplow_autogen'
      
      dispatch:
        - macro_namespace: dbt
          search_order: ['snowplow_utils', 'dbt']
      
      model-paths: ["models"]
      analysis-paths: ["analyses"]
      test-paths: ["tests"]
      seed-paths: ["seeds"]
      macro-paths: ["macros"]
      snapshot-paths: ["snapshots"]
      docs-paths: ["docs"]
      
      target-path: "target"
      clean-targets:
        - "target"
        - "dbt_packages"
        - "logs"
        
      models:
        ecommerce_transaction_interactions_features_1:
          +materialized: table
          +file_format:  "{{ 'delta' if target.type not in ['spark'] else 'iceberg'}}"
          +incremental_strategy: "{{ None if target.type not in ['spark'] else 'merge' }}"
          +bind: false
          base:
            +tags: "base"
            manifest:
              +schema: "snowplow_manifest"
            scratch:
              +schema: "scratch"
              +tags: "scratch"
          filtered_events:
            +schema: "derived"
            +tags: "ecommerce_transaction_interactions_features_1_incremental"
            scratch:
              +schema: "scratch"
              +tags: "scratch"
          daily_aggregates:
            +schema: "derived"
            +tags: "ecommerce_transaction_interactions_features_1_incremental"
            scratch:
              +schema: "scratch"
              +tags: "scratch"
            manifest:
              +schema: "snowplow_manifest"
          attributes:
            +schema: "derived"
            +tags: "ecommerce_transaction_interactions_features_1_incremental"
      
      vars:
        ecommerce_transaction_interactions_features_1:
      
          # OPERATION & LOGIC
          
          # filtered_events
          snowplow__start_date: '2025-01-01' # Date from which this module starts processing events (based on both load_tstamp and derived_tstamp)
          snowplow__app_id: [] # Filter the data on specific app_ids
          snowplow__backfill_limit_days: 1 # Limit backfill increments for the filtered_events_table
          
          # daily_aggregates
          snowplow__late_event_lookback_days: 5 # The number of days to allow for late arriving data to be reprocessed during daily aggregation 
          snowplow__min_late_events_to_process: 1 # The threshold number of skipped daily events to process (when reached) during daily aggregation
          
          # aggregates
          snowplow__include_current_day_in_windows: false # If set to true, the current_day with incomplete data is also taken into account for last_x_day type windows
          snowplow__allow_refresh: false #  If set to true, the incremental manifest will be dropped when running with a `--full-refresh` flag
      
          # WAREHOUSE & TRACKER
          
          snowplow__dev_target_name: dev 
          # snowplow__atomic_schema: 'atomic' # Only set if not using 'atomic' schema for Snowplow events data
          # snowplow__database: # Only set if not using target.database for Snowplow events data -- WILL BE IGNORED FOR DATABRICKS
          # snowplow__events_table: "events" # Only set if not using 'events' table for Snowplow events data
          snowplow__custom_filter: '1=1' # Additional filter to be applied on the base_events_this_run table
          
          # PRIVATE VARS - DO NOT MODIFY
          snowplow__databricks_catalog: "hive_metastore"
          snowplow__events: "{{ source('atomic', 'events') }}"
          snowplow__entity_key: 'domain_userid' # The entity key to use as grain for aggregations (e.g. domain_userid)
      
      on-run-start:
        - "{{ snowplow_utils.snowplow_delete_from_manifest(var('models_to_remove',[])) }}"
      
      on-run-end:
        - "{{ snowplow_utils.snowplow_incremental_post_hook_t(package_name='ecommerce_transaction_interactions_features_1', incremental_manifest_table_name='ecommerce_transaction_interactions_features_1_incremental_manifest', base_events_this_run_table_name='ecommerce_transaction_interactions_features_1_base_events_this_run') }}"
        - "{{ snowplow_utils.grant_usage_on_schemas_built_into(var('snowplow__grant_schemas', true)) }}"
  
    ''',
    'ecommerce_transaction_interactions_features_1/macros/allow_refresh.sql': '''
      {#
      Copyright (c) 2025-present Snowplow Analytics Ltd. All rights reserved.
      This program is licensed to you under the Snowplow Personal and Academic License Version 1.0,
      and you may not use this file except in compliance with the Snowplow Personal and Academic License Version 1.0.
      You may obtain a copy of the Snowplow Personal and Academic License Version 1.0 at https://docs.snowplow.io/personal-and-academic-license-1.0/
      #}
      
      {# Default: Allow refresh in dev, block refresh otherwise. dev defined by snowplow__dev_target_name #}
      
      {% macro allow_refresh() %}
        {{ return(adapter.dispatch('allow_refresh', 'ecommerce_transaction_interactions_features_1')()) }}
      {% endmacro %}
      
      {% macro default__allow_refresh() %}
      
        {% if flags.FULL_REFRESH == True %}
          {% set allow_refresh = snowplow_utils.get_value_by_target(
                                            dev_value=none,
                                            default_value=var('snowplow__allow_refresh'),
                                            dev_target_name=var('snowplow__dev_target_name')
                                            ) %}
        {% else %}
          {% set allow_refresh = none %}
        {% endif %}
      
        {{ return(allow_refresh) }}
      
      {% endmacro %}
  
    ''',
    'ecommerce_transaction_interactions_features_1/macros/get_cluster_by_values.sql': '''
      {#
      Copyright (c) 2025-present Snowplow Analytics Ltd. All rights reserved.
      This program is licensed to you under the Snowplow Personal and Academic License Version 1.0,
      and you may not use this file except in compliance with the Snowplow Personal and Academic License Version 1.0.
      You may obtain a copy of the Snowplow Personal and Academic License Version 1.0 at https://docs.snowplow.io/personal-and-academic-license-1.0/
      #}
      
      {% macro get_cluster_by_values(model) %}
          {{ return(adapter.dispatch('get_cluster_by_values', 'ecommerce_transaction_interactions_features_1')(model)) }}
      {% endmacro %}
      
      
      {% macro default__get_cluster_by_values(model) %}
          {% if model == 'dummy' %}
              {{ return(snowplow_utils.get_value_by_target_type(bigquery_val=["session_identifier"], snowflake_val=["to_date(start_tstamp)"])) }}
          {% else %}
              {{ exceptions.raise_compiler_error(
            "Snowplow Error: Model "~model~" not defined for cluster by."
            ) }}
          {% endif %}
      {% endmacro %}
  
    ''',
    'ecommerce_transaction_interactions_features_1/macros/get_limits_for_attributes.sql': '''
      {#
      Copyright (c) 2025-present Snowplow Analytics Ltd. All rights reserved.
      This program is licensed to you under the Snowplow Personal and Academic License Version 1.0,
      and you may not use this file except in compliance with the Snowplow Personal and Academic License Version 1.0.
      You may obtain a copy of the Snowplow Personal and Academic License Version 1.0 at https://docs.snowplow.io/personal-and-academic-license-1.0/
      #}
      
      {% macro get_limits_for_attributes() -%}
      
        {# upper limit only applies to last n day aggregates in case the user does not want to include current date in the aggregations #}
        {# TODO: implement lower limit for reducing unnecessary scans in case there are only last n day aggregate attributes #}
      
        
        {% if var('snowplow__mock_current_day', false) %}
          {% set current_day = "DATE '" ~ var("snowplow__mock_current_day") ~ "'" %}
        {% else %}
          {% if target.type == "snowflake" %}
            {% set current_day = "CAST(CONVERT_TIMEZONE('UTC', CURRENT_TIMESTAMP()) AS DATE)" %}
          {% elif target.type == "bigquery" %}
            {% set current_day = "CURRENT_DATE" %}
          {% endif %}
        {% endif %}
      
        {# Calculate upper limit depending on include_current_day #}
        {% if var("snowplow__include_current_day_in_windows", false) %}
          {% set upper_limit = snowplow_utils.add_days_to_date(1, current_day) %}
        {% else %}
          {% set upper_limit = current_day %}
        {% endif %}
      
        {# Static lower limit from var #}
        {% set lower_limit = "DATE '" ~ var("snowplow__start_date", "2025-01-01") ~ "'" %}
      
        {% if execute %}
          {{ return([lower_limit, upper_limit]) }}
        {% else %}
          {{ return(["", ""]) }}
        {% endif %}
        
      {% endmacro %}
      
  
    ''',
    'ecommerce_transaction_interactions_features_1/models/attributes/ecommerce_transaction_interactions_features_1_attributes.sql': '''
      
      {#
      Copyright (c) 2025-present Snowplow Analytics Ltd. All rights reserved.
      This program is licensed to you under the Snowplow Personal and Academic License Version 1.0,
      and you may not use this file except in compliance with the Snowplow Personal and Academic License Version 1.0.
      You may obtain a copy of the Snowplow Personal and Academic License Version 1.0 at https://docs.snowplow.io/personal-and-academic-license-1.0/
      #}
      
      {{
        config(
          materialized='table',
          dist=var('snowplow__entity_key', 'domain_userid'),
          partition_by = snowplow_utils.get_value_by_target_type(bigquery_val = {
            "field": "valid_at_tstamp",
            "data_type": "timestamp"
          }, databricks_val='last_event_date'),
          sql_header=snowplow_utils.set_query_tag(var('snowplow__query_tag', 'snowplow_dbt')),
        )
      }}
      
      {%- set lower_limit, upper_limit = get_limits_for_attributes() %}
      
      with  aggregations as (
      
        select 
          entity_key
          , min(1) --dummy value in case there are no aggregate values in the view definitions
      
          
          
            , sum(case when event_date >= {{snowplow_utils.add_days_to_date(-7, upper_limit)}} and event_date < {{ upper_limit }} then count_page_view end) as page_view_events_count_last_7_days
          
            , sum(case when event_date >= {{snowplow_utils.add_days_to_date(-7, upper_limit)}} and event_date < {{ upper_limit }} then count_page_ping end) as page_ping_events_count_last_7_days
          
            , sum(case when event_date >= {{snowplow_utils.add_days_to_date(-7, upper_limit)}} and event_date < {{ upper_limit }} then count_page_view_page_url_like_pctpricingpct end) as pricing_pageview_count_last_7_days
          
            , sum(case when event_date >= {{snowplow_utils.add_days_to_date(-7, upper_limit)}} and event_date < {{ upper_limit }} then count_page_view_page_url_like_pctdemopct end) as demo_pageview_count_last_7_days
          
            , sum(case when event_date >= {{snowplow_utils.add_days_to_date(-7, upper_limit)}} and event_date < {{ upper_limit }} then media_video_event_count_last_7_days end) as media_video_event_count_last_7_days
          
            , sum(case when event_date >= {{snowplow_utils.add_days_to_date(-7, upper_limit)}} and event_date < {{ upper_limit }} then count_focus_form_change_form end) as form_focus_change_event_count_last_7_days
          
            , sum(case when event_date >= {{snowplow_utils.add_days_to_date(-7, upper_limit)}} and event_date < {{ upper_limit }} then sum_revenue_snowplow_ecommerce_action end) as total_revenue_last_7_days
          
      
      
        from {{ ref('ecommerce_transaction_interactions_features_1_daily_aggregates')}}
      
        group by 1
        
      )
      
      
      
        
        
        
        
        
        
        
      
        , op_systems_flattened as (
          select
              d.entity_key,
              array_agg(distinct cast(f{% if target.type == 'snowflake' %}.value{% endif %} as {{ dbt.type_string() }}) {% if target.type == 'bigquery' %} ORDER BY f{% endif %}) as op_systems
          from {{ ref('ecommerce_transaction_interactions_features_1_daily_aggregates') }} d,
               {% if target.type == 'snowflake' %}
                 LATERAL FLATTEN(input => op_systems) f
               {% elif target.type == 'bigquery' %}
                 UNNEST(d.op_systems) AS f
               {% endif %}
          group by d.entity_key
        )
      
        
        
        
        
        
        
        
          , filtered_data_op_systems_2 as (
            select
                entity_key,
                op_systems_2
            from {{ ref('ecommerce_transaction_interactions_features_1_daily_aggregates') }}
            where event_date >= {{ dbt.dateadd('day', -1, upper_limit) }}
          )
        
      
        , op_systems_2_flattened as (
          select
              d.entity_key,
              array_agg(distinct cast(f{% if target.type == 'snowflake' %}.value{% endif %} as {{ dbt.type_string() }}) {% if target.type == 'bigquery' %} ORDER BY f{% endif %}) as op_systems_2
          from filtered_data_op_systems_2 d,
               {% if target.type == 'snowflake' %}
                 LATERAL FLATTEN(input => op_systems_2) f
               {% elif target.type == 'bigquery' %}
                 UNNEST(d.op_systems_2) AS f
               {% endif %}
          group by d.entity_key
        )
      
      
      , window_calculations as (
        
        select distinct
          entity_key
      
        
          , first_value(first_mkt_source) over (
                      partition by entity_key
                      order by last_event_tstamp ASC
                  ) as first_mkt_source
        
      
        
          , first_value(first_mkt_medium) over (
                      partition by entity_key
                      order by last_event_tstamp ASC
                  ) as first_mkt_medium
        
      
        
          , first_value(first_refr_source) over (
                      partition by entity_key
                      order by last_event_tstamp ASC
                  ) as first_referrer_source
        
      
        
          , first_value(first_refr_medium) over (
                      partition by entity_key
                      order by last_event_tstamp ASC
                  ) as first_referrer_medium
        
      
      
        
          , last_value(last_geo_country) over (
                      partition by entity_key
                      order by last_event_tstamp ASC ROWS BETWEEN UNBOUNDED PRECEDING AND UNBOUNDED FOLLOWING
                  ) as last_geo_country
        
      
        
          , last_value(last_geo_timezone) over (
                      partition by entity_key
                      order by last_event_tstamp ASC ROWS BETWEEN UNBOUNDED PRECEDING AND UNBOUNDED FOLLOWING
                  ) as last_timezone
        
      
        
          , last_value(last_operating_system_name) over (
                      partition by entity_key
                      order by last_event_tstamp ASC ROWS BETWEEN UNBOUNDED PRECEDING AND UNBOUNDED FOLLOWING
                  ) as last_os
        
      
        
          , last_value(last_device_class) over (
                      partition by entity_key
                      order by last_event_tstamp ASC ROWS BETWEEN UNBOUNDED PRECEDING AND UNBOUNDED FOLLOWING
                  ) as last_device_class
        
      
        
          , last_value(last_mkt_source) over (
                      partition by entity_key
                      order by last_event_tstamp ASC ROWS BETWEEN UNBOUNDED PRECEDING AND UNBOUNDED FOLLOWING
                  ) as last_mkt_source
        
      
        
          , last_value(last_mkt_medium) over (
                      partition by entity_key
                      order by last_event_tstamp ASC ROWS BETWEEN UNBOUNDED PRECEDING AND UNBOUNDED FOLLOWING
                  ) as last_mkt_medium
        
      
      
        from {{ ref('ecommerce_transaction_interactions_features_1_daily_aggregates')}}
        
      )
      
      
      
      select
          
        a.entity_key as domain_userid,
        {{ snowplow_utils.current_timestamp_in_utc() }} as valid_at_tstamp,
        date({{ lower_limit }}) as lower_limit,
        date({{ upper_limit }}) as upper_limit
        
          , w.first_mkt_source
          , w.first_mkt_medium
          , w.first_referrer_source
          , w.first_referrer_medium
      
        -- time window based attributes
        
          , page_view_events_count_last_7_days
        
          , page_ping_events_count_last_7_days
        
          , pricing_pageview_count_last_7_days
        
          , demo_pageview_count_last_7_days
        
          , media_video_event_count_last_7_days
        
          , form_focus_change_event_count_last_7_days
        
          , total_revenue_last_7_days
        
          
        -- lifetime based attributes
        
      
        -- user lasts
        
          , w.last_geo_country
          , w.last_timezone
          , w.last_os
          , w.last_device_class
          , w.last_mkt_source
          , w.last_mkt_medium
        
        -- unique_list_attributes
        
        , op_systems
        , op_systems_2
      from aggregations as a
      left join window_calculations as w
      on a.entity_key = w.entity_key
      
      
      
        left join op_systems_flattened as op_systems_flattened
        on a.entity_key = op_systems_flattened.entity_key
      
        left join op_systems_2_flattened as op_systems_2_flattened
        on a.entity_key = op_systems_2_flattened.entity_key
  
    ''',
    'ecommerce_transaction_interactions_features_1/models/base/manifest/ecommerce_transaction_interactions_features_1_incremental_manifest.sql': '''
      {#
      Copyright (c) 2025-present Snowplow Analytics Ltd. All rights reserved.
      This program is licensed to you under the Snowplow Personal and Academic License Version 1.0,
      and you may not use this file except in compliance with the Snowplow Personal and Academic License Version 1.0.
      You may obtain a copy of the Snowplow Personal and Academic License Version 1.0 at https://docs.snowplow.io/personal-and-academic-license-1.0/
      #}
      
      {{
        config(
          materialized='incremental',
          sql_header=snowplow_utils.set_query_tag(var('snowplow__query_tag', 'snowplow_dbt')),
          tblproperties={
            'delta.autoOptimize.optimizeWrite' : 'true',
            'delta.autoOptimize.autoCompact' : 'true'
          },
        )
      }}
      
      {% set incremental_manifest_query = snowplow_utils.base_create_snowplow_incremental_manifest_t() %}
      
      {{ incremental_manifest_query }}
      
      {# TODO: add full refresh in config! #}
  
    ''',
    'ecommerce_transaction_interactions_features_1/models/base/scratch/ecommerce_transaction_interactions_features_1_base_events_this_run.sql': '''
      {#
      Copyright (c) 2025-present Snowplow Analytics Ltd. All rights reserved.
      This program is licensed to you under the Snowplow Personal and Academic License Version 1.0,
      and you may not use this file except in compliance with the Snowplow Personal and Academic License Version 1.0.
      You may obtain a copy of the Snowplow Personal and Academic License Version 1.0 at https://docs.snowplow.io/personal-and-academic-license-1.0/
      #}
      
      {{
        config(
          sort='load_tstamp',
          dist='event_id',
          tags=["this_run"]
        )
      }}
      
      {% set base_events_query = snowplow_utils.base_create_snowplow_events_this_run_t(
                                    run_limits_table='ecommerce_transaction_interactions_features_1_base_new_event_limits',
                                    app_ids=var('snowplow__app_id', []),
                                    snowplow_events_database=var('snowplow__database', target.database) if target.type not in ['databricks', 'spark'] else var('snowplow__databricks_catalog', 'hive_metastore') if target.type in ['databricks'] else var('snowplow__atomic_schema', 'atomic'),
                                    snowplow_events_schema=var('snowplow__atomic_schema', 'atomic'),
                                    snowplow_events_table=var('snowplow__events_table', 'events'),
                                    event_names=var('snowplow__events_to_include', []),
                                    custom_filter=var('snowplow__custom_filter', none)
                                    ) %}
      
      {{ base_events_query }}
  
    ''',
    'ecommerce_transaction_interactions_features_1/models/base/scratch/ecommerce_transaction_interactions_features_1_base_new_event_limits.sql': '''
      
      {#
      Copyright (c) 2025-present Snowplow Analytics Ltd. All rights reserved.
      This program is licensed to you under the Snowplow Personal and Academic License Version 1.0,
      and you may not use this file except in compliance with the Snowplow Personal and Academic License Version 1.0.
      You may obtain a copy of the Snowplow Personal and Academic License Version 1.0 at https://docs.snowplow.io/personal-and-academic-license-1.0/
      #}
      
      {{ config(
         post_hook=["{{snowplow_utils.print_run_limits(this, 'ecommerce_transaction_interactions_features_1')}}"],
         sql_header=snowplow_utils.set_query_tag(var('snowplow__query_tag', 'snowplow_dbt'))
         )
      }}
      
      
      {%- set models_in_run = snowplow_utils.get_enabled_snowplow_models('ecommerce_transaction_interactions_features_1', base_events_table_name='ecommerce_transaction_interactions_features_1_snowplow_base_events_this_run') -%}
      
      {% set min_first_processed_load_tstamp,
            max_first_processed_load_tstamp,
            min_last_processed_load_tstamp,
            max_last_processed_load_tstamp,
            models_matched_from_manifest,
            sync_count,
            has_matched_all_models = snowplow_utils.get_incremental_manifest_status_t(ref('ecommerce_transaction_interactions_features_1_incremental_manifest'),
                                                                                       models_in_run) -%}
      
      {% set run_limits_query = snowplow_utils.get_run_limits_t(min_first_processed_load_tstamp,
                                                               max_first_processed_load_tstamp,
                                                               min_last_processed_load_tstamp,
                                                               max_last_processed_load_tstamp,
                                                               models_matched_from_manifest,
                                                               sync_count,
                                                               has_matched_all_models,
                                                               var("snowplow__start_date","2024-01-01")) -%}
      
      {{ run_limits_query }}
  
    ''',
    'ecommerce_transaction_interactions_features_1/models/base/src_base.yml': '''
      version: 2
      
      sources:
        - name: atomic
          schema: "{{ var('snowplow__atomic_schema', 'atomic') }}"
          database: "{{ var('snowplow__database', target.database) if target.type not in ['databricks', 'spark'] else var('snowplow__databricks_catalog', 'hive_metastore') if target.type in ['databricks'] else var('snowplow__atomic_schema', 'atomic') }}"
          tables:
            - name: events
              identifier: "{{ var('snowplow__events_table', 'events') }}"
  
    ''',
    'ecommerce_transaction_interactions_features_1/models/daily_aggregates/ecommerce_transaction_interactions_features_1_daily_aggregates.sql': '''
      
      {#
      Copyright (c) 2025-present Snowplow Analytics Ltd. All rights reserved.
      This program is licensed to you under the Snowplow Personal and Academic License Version 1.0,
      and you may not use this file except in compliance with the Snowplow Personal and Academic License Version 1.0.
      You may obtain a copy of the Snowplow Personal and Academic License Version 1.0 at https://docs.snowplow.io/personal-and-academic-license-1.0/
      #}
      
      {{
        config(
          materialized='incremental',
          sort='event_date',
          dist='entity_key',
          partition_by = snowplow_utils.get_value_by_target_type(bigquery_val = {
            "field": "event_date",
            "data_type": "date"
          }, databricks_val='event_date'),
          unique_key='entity_key_date_id',
          upsert_date_key='event_date',
          tags=["derived"],
          on_schema_change='append_new_columns',
          cluster_by=snowplow_utils.get_value_by_target_type(bigquery_val=["event_date","entity_key"], snowflake_val=["event_date"]),
          sql_header=snowplow_utils.set_query_tag(var('snowplow__query_tag', 'snowplow_dbt')),
          tblproperties={
            'delta.autoOptimize.optimizeWrite' : 'true',
            'delta.autoOptimize.autoCompact' : 'true'
          },
          snowplow_optimize = true
        )
      }}
      
      select * from
      {{ ref('ecommerce_transaction_interactions_features_1_daily_aggregates_this_run') }}
  
    ''',
    'ecommerce_transaction_interactions_features_1/models/daily_aggregates/manifest/ecommerce_transaction_interactions_features_1_daily_aggregation_manifest.sql': '''
      
      {#
      Copyright (c) 2025-present Snowplow Analytics Ltd. All rights reserved.
      This program is licensed to you under the Snowplow Personal and Academic License Version 1.0,
      and you may not use this file except in compliance with the Snowplow Personal and Academic License Version 1.0.
      You may obtain a copy of the Snowplow Personal and Academic License Version 1.0 at https://docs.snowplow.io/personal-and-academic-license-1.0/
      #}
      
      {#
          Dynamic manifest that tracks all daily metrics models.
          Dependencies must be declared statically for dbt's DAG.
      #}
      
      -- depends_on: {{ ref('ecommerce_transaction_interactions_features_1_daily_aggregates_this_run') }}
      -- depends_on: {{ ref('ecommerce_transaction_interactions_features_1_filtered_events_this_run') }}
      -- depends_on: {{ ref('ecommerce_transaction_interactions_features_1_filtered_events') }}
      -- depends_on: {{ ref('ecommerce_transaction_interactions_features_1_daily_aggregates') }}
      
      {{
          config(
              materialized='incremental',
              unique_key=['event_date', 'source_model'],
              on_schema_change='sync_all_columns',
              sql_header=snowplow_utils.set_query_tag(var('snowplow__query_tag', 'snowplow_dbt')))
      }}
      
      {% set daily_aggregation_manifest_query = snowplow_utils.create_daily_aggregation_manifest('ecommerce_transaction_interactions_features_1') %}
      
      {{ daily_aggregation_manifest_query }}
      
       
    ''',
    'ecommerce_transaction_interactions_features_1/models/daily_aggregates/scratch/ecommerce_transaction_interactions_features_1_daily_aggregates_this_run.sql': '''
      
      {#Copyright (c) 2025-present Snowplow Analytics Ltd. All rights reserved.
      This program is licensed to you under the Snowplow Personal and Academic License Version 1.0,
      and you may not use this file except in compliance with the Snowplow Personal and Academic License Version 1.0.
      You may obtain a copy of the Snowplow Personal and Academic License Version 1.0 at https://docs.snowplow.io/personal-and-academic-license-1.0/
      #}
      
      {{
          config(
              tags=["this_run"],
              materialized="table",
              sql_header=snowplow_utils.set_query_tag(var('snowplow__query_tag', 'snowplow_dbt')),
              unique_key=['entity_key_date_id']
          )
      }}
      
      with events as (
        select e.* 
        from {{ ref('ecommerce_transaction_interactions_features_1_filtered_events') }} e
        inner join {{ ref('ecommerce_transaction_interactions_features_1_days_to_process') }} d
            on date(e.derived_tstamp) = d.event_date
      )
      
      , aggregations as (
        
        select
          entity_key_date_id,
          entity_key,
          event_date
          
          
            
              , sum(
            
              case when  event_name IN('page_view') then 1 else 0 end) as count_page_view
          
            
              , sum(
            
              case when  event_name IN('page_ping') then 1 else 0 end) as count_page_ping
          
            
              , sum(
            
              case when  event_name IN('page_view') and  page_url LIKE '%%pricing%%' then 1 else 0 end) as count_page_view_page_url_like_pctpricingpct
          
            
              , sum(
            
              case when  event_name IN('page_view') and  page_url LIKE '%%demo%%' then 1 else 0 end) as count_page_view_page_url_like_pctdemopct
          
            
              , sum(
            
              case when  event_name IN('quality_change_event','pause_event','volume_change_event','percent_progress_event','ad_quartile_event','ping_event','seek_start_event','seek_end_event','end_event','ad_start_event','play_event','ready_event','playback_rate_change_event','ad_break_start_event','ad_complete_event','ad_skip_event','buffer_start_event','buffer_end_event','ad_break_end_event') then 1 else 0 end) as media_video_event_count_last_7_days
          
            
              , sum(
            
              case when  event_name IN('focus_form','change_form') then 1 else 0 end) as count_focus_form_change_form
          
            
              , sum(
            
              case when  event_name IN('snowplow_ecommerce_action') then cast(revenue as {{ dbt.type_float()}}) else 0 end) as sum_revenue_snowplow_ecommerce_action
          
            
              , array_agg(
            
              distinct case when  event_name IN('page_view','page_ping','snowplow_ecommerce_action') and  (revenue != 1 or revenue is null) then operating_system_name else null end) as op_systems
          
            
              , array_agg(
            
              distinct case when  event_name IN('page_view','page_ping','snowplow_ecommerce_action') and  (revenue != 1 or revenue is null) then operating_system_name else null end) as op_systems_2
          
          
        from events
        group by 1,2,3
      )
      
      --TODO: consider separating them to user_lasts and user_firsts to avoid having to do multiple window functions if these fields get bigger and the query optimizer does not catch them
      , window_calculations as (
        
        select
          *,
          last_value(derived_tstamp) over (partition by entity_key_date_id order by derived_tstamp ROWS BETWEEN UNBOUNDED PRECEDING AND UNBOUNDED FOLLOWING) as last_event_tstamp
              
          
            , first_value(mkt_source) over (partition by entity_key_date_id order by derived_tstamp ROWS BETWEEN UNBOUNDED PRECEDING AND UNBOUNDED FOLLOWING) as first_mkt_source
            , first_value(mkt_medium) over (partition by entity_key_date_id order by derived_tstamp ROWS BETWEEN UNBOUNDED PRECEDING AND UNBOUNDED FOLLOWING) as first_mkt_medium
            , first_value(refr_source) over (partition by entity_key_date_id order by derived_tstamp ROWS BETWEEN UNBOUNDED PRECEDING AND UNBOUNDED FOLLOWING) as first_refr_source
            , first_value(refr_medium) over (partition by entity_key_date_id order by derived_tstamp ROWS BETWEEN UNBOUNDED PRECEDING AND UNBOUNDED FOLLOWING) as first_refr_medium
          
            , last_value(geo_country) over (partition by entity_key_date_id order by derived_tstamp ROWS BETWEEN UNBOUNDED PRECEDING AND UNBOUNDED FOLLOWING) as last_geo_country
            , last_value(geo_timezone) over (partition by entity_key_date_id order by derived_tstamp ROWS BETWEEN UNBOUNDED PRECEDING AND UNBOUNDED FOLLOWING) as last_geo_timezone
            , last_value(operating_system_name) over (partition by entity_key_date_id order by derived_tstamp ROWS BETWEEN UNBOUNDED PRECEDING AND UNBOUNDED FOLLOWING) as last_operating_system_name
            , last_value(device_class) over (partition by entity_key_date_id order by derived_tstamp ROWS BETWEEN UNBOUNDED PRECEDING AND UNBOUNDED FOLLOWING) as last_device_class
            , last_value(mkt_source) over (partition by entity_key_date_id order by derived_tstamp ROWS BETWEEN UNBOUNDED PRECEDING AND UNBOUNDED FOLLOWING) as last_mkt_source
            , last_value(mkt_medium) over (partition by entity_key_date_id order by derived_tstamp ROWS BETWEEN UNBOUNDED PRECEDING AND UNBOUNDED FOLLOWING) as last_mkt_medium
        
        from events
        
      )
      
      select distinct
        a.entity_key_date_id,
        a.entity_key,
        a.event_date,
        w.last_event_tstamp
      
          
          , a.count_page_view
        
          , a.count_page_ping
        
          , a.count_page_view_page_url_like_pctpricingpct
        
          , a.count_page_view_page_url_like_pctdemopct
        
          , a.media_video_event_count_last_7_days
        
          , a.count_focus_form_change_form
        
          , a.sum_revenue_snowplow_ecommerce_action
        
          , a.op_systems
        
          , a.op_systems_2
        
        
          
          , w.first_mkt_source
          , w.first_mkt_medium
          , w.first_refr_source
          , w.first_refr_medium
        
          
          , w.last_geo_country
          , w.last_geo_timezone
          , w.last_operating_system_name
          , w.last_device_class
          , w.last_mkt_source
          , w.last_mkt_medium
      
      from aggregations a
      
      left join window_calculations w
      on w.entity_key_date_id = a.entity_key_date_id
      
  
    ''',
    'ecommerce_transaction_interactions_features_1/models/daily_aggregates/scratch/ecommerce_transaction_interactions_features_1_days_to_process.sql': '''
      
      {#
      Copyright (c) 2023-present Snowplow Analytics Ltd. All rights reserved.
      This program is licensed to you under the Snowplow Personal and Academic License Version 1.0,
      and you may not use this file except in compliance with the Snowplow Personal and Academic License Version 1.0.
      You may obtain a copy of the Snowplow Personal and Academic License Version 1.0 at https://docs.snowplow.io/personal-and-academic-license-1.0/
      #}
      
      {{
          config(
              materialized='table',
              tags=['snowplow_autogen', 'dates_to_process'],
              sql_header=snowplow_utils.set_query_tag(var('snowplow__query_tag', 'snowplow_dbt')),
              post_hook=[
                  "{{ snowplow_utils.print_dates_to_process() }}"
              ]
          )
      }}
      
      {% set dates_to_process_query = snowplow_utils.get_dates_to_process(
          'ecommerce_transaction_interactions_features_1_filtered_events_this_run',
          'ecommerce_transaction_interactions_features_1_daily_aggregation_manifest'
      ) %}
      
      {{ dates_to_process_query }}
  
    ''',
    'ecommerce_transaction_interactions_features_1/models/filtered_events/ecommerce_transaction_interactions_features_1_filtered_events.sql': '''
      
      {#
      Copyright (c) 2025-present Snowplow Analytics Ltd. All rights reserved.
      This program is licensed to you under the Snowplow Personal and Academic License Version 1.0,
      and you may not use this file except in compliance with the Snowplow Personal and Academic License Version 1.0.
      You may obtain a copy of the Snowplow Personal and Academic License Version 1.0 at https://docs.snowplow.io/personal-and-academic-license-1.0/
      #}
      {{ config(
          materialized = "incremental",
          unique_key = "event_id",
          upsert_date_key = "derived_tstamp",
          partition_by = snowplow_utils.get_value_by_target_type(
              bigquery_val={
              "field": "derived_tstamp",
              "data_type": "timestamp"
          }, 
          databricks_val='derived_tstamp_date'),
          sql_header=snowplow_utils.set_query_tag(var('snowplow__query_tag', 'snowplow_dbt')),
          tblproperties={
            'delta.autoOptimize.optimizeWrite' : 'true',
            'delta.autoOptimize.autoCompact' : 'true'
          },
          snowplow_optimize=true
      ) }}
      
      select *
          
      from {{ ref('ecommerce_transaction_interactions_features_1_filtered_events_this_run') }}
      where {{ snowplow_utils.is_run_with_new_events("ecommerce_transaction_interactions_features_1"
              , new_event_limits_table="ecommerce_transaction_interactions_features_1_base_new_event_limits"
              , incremental_manifest_table="ecommerce_transaction_interactions_features_1_incremental_manifest"
              , base_sessions_lifecycle_table="ecommerce_transaction_interactions_features_1_base_sessions_lifecycle"
              ) }}
  
    ''',
    'ecommerce_transaction_interactions_features_1/models/filtered_events/scratch/ecommerce_transaction_interactions_features_1_filtered_events_this_run.sql': '''
      {#
      Copyright (c) 2025-present Snowplow Analytics Ltd. All rights reserved.
      This program is licensed to you under the Snowplow Personal and Academic License Version 1.0,
      and you may not use this file except in compliance with the Snowplow Personal and Academic License Version 1.0.
      You may obtain a copy of the Snowplow Personal and Academic License Version 1.0 at https://docs.snowplow.io/personal-and-academic-license-1.0/
      #}
      
      {{
          config(
              tags=["this_run"],
              materialized="table",
              sql_header=snowplow_utils.set_query_tag(var('snowplow__query_tag', 'snowplow_dbt'))
          )
      }}
      
      with prep as (
      
          select
              event_id,
              {{ var('snowplow__entity_key', 'domain_userid') }} as entity_key,
              derived_tstamp,
              date(derived_tstamp) as event_date,
              load_tstamp,
              event_name,
              
                  
                      geo_country AS geo_country,
              
                  
                      geo_timezone AS geo_timezone,
              
                  
                      contexts_nl_basjes_yauaa_context_1[0]:operatingSystemName AS operating_system_name,
              
                  
                      contexts_nl_basjes_yauaa_context_1[0]:deviceClass AS device_class,
              
                  
                      mkt_source AS mkt_source,
              
                  
                      mkt_medium AS mkt_medium,
              
                  
                      refr_source AS refr_source,
              
                  
                      refr_medium AS refr_medium,
              
                  
                      page_url AS page_url,
              
                  
                      contexts_com_snowplowanalytics_snowplow_ecommerce_transaction_1[0]:revenue AS revenue
              
      
          from
              {{ ref('ecommerce_transaction_interactions_features_1_base_events_this_run') }}
          where 
              (event_name = 'page_view'
                  and event_vendor = 'com.snowplowanalytics.snowplow'
                  and event_version = '1-0-0'
              ) or 
      
          
              (event_name = 'page_ping'
                  and event_vendor = 'com.snowplowanalytics.snowplow'
                  and event_version = '1-0-0'
              ) or 
      
          
              (event_name = 'ad_break_end_event'
                  and event_vendor = 'com.snowplowanalytics.snowplow.media'
                  and event_version = '1-0-0'
              ) or 
      
          
              (event_name = 'ad_break_start_event'
                  and event_vendor = 'com.snowplowanalytics.snowplow.media'
                  and event_version = '1-0-0'
              ) or 
      
          
              (event_name = 'ad_complete_event'
                  and event_vendor = 'com.snowplowanalytics.snowplow.media'
                  and event_version = '1-0-0'
              ) or 
      
          
              (event_name = 'ad_quartile_event'
                  and event_vendor = 'com.snowplowanalytics.snowplow.media'
                  and event_version = '1-0-0'
              ) or 
      
          
              (event_name = 'ad_skip_event'
                  and event_vendor = 'com.snowplowanalytics.snowplow.media'
                  and event_version = '1-0-0'
              ) or 
      
          
              (event_name = 'ad_start_event'
                  and event_vendor = 'com.snowplowanalytics.snowplow.media'
                  and event_version = '1-0-0'
              ) or 
      
          
              (event_name = 'buffer_end_event'
                  and event_vendor = 'com.snowplowanalytics.snowplow.media'
                  and event_version = '1-0-0'
              ) or 
      
          
              (event_name = 'buffer_start_event'
                  and event_vendor = 'com.snowplowanalytics.snowplow.media'
                  and event_version = '1-0-0'
              ) or 
      
          
              (event_name = 'end_event'
                  and event_vendor = 'com.snowplowanalytics.snowplow.media'
                  and event_version = '1-0-0'
              ) or 
      
          
              (event_name = 'pause_event'
                  and event_vendor = 'com.snowplowanalytics.snowplow.media'
                  and event_version = '1-0-0'
              ) or 
      
          
              (event_name = 'percent_progress_event'
                  and event_vendor = 'com.snowplowanalytics.snowplow.media'
                  and event_version = '1-0-0'
              ) or 
      
          
              (event_name = 'ping_event'
                  and event_vendor = 'com.snowplowanalytics.snowplow.media'
                  and event_version = '1-0-0'
              ) or 
      
          
              (event_name = 'play_event'
                  and event_vendor = 'com.snowplowanalytics.snowplow.media'
                  and event_version = '1-0-0'
              ) or 
      
          
              (event_name = 'playback_rate_change_event'
                  and event_vendor = 'com.snowplowanalytics.snowplow.media'
                  and event_version = '1-0-0'
              ) or 
      
          
              (event_name = 'quality_change_event'
                  and event_vendor = 'com.snowplowanalytics.snowplow.media'
                  and event_version = '1-0-0'
              ) or 
      
          
              (event_name = 'ready_event'
                  and event_vendor = 'com.snowplowanalytics.snowplow.media'
                  and event_version = '1-0-0'
              ) or 
      
          
              (event_name = 'seek_end_event'
                  and event_vendor = 'com.snowplowanalytics.snowplow.media'
                  and event_version = '1-0-0'
              ) or 
      
          
              (event_name = 'seek_start_event'
                  and event_vendor = 'com.snowplowanalytics.snowplow.media'
                  and event_version = '1-0-0'
              ) or 
      
          
              (event_name = 'volume_change_event'
                  and event_vendor = 'com.snowplowanalytics.snowplow.media'
                  and event_version = '1-0-0'
              ) or 
      
          
              (event_name = 'change_form'
                  and event_vendor = 'com.snowplowanalytics.snowplow'
                  and event_version = '1-0-0'
              ) or 
      
          
              (event_name = 'focus_form'
                  and event_vendor = 'com.snowplowanalytics.snowplow'
                  and event_version = '1-0-0'
              ) or 
      
          
              (event_name = 'snowplow_ecommerce_action'
                  and event_vendor = 'com.snowplowanalytics.snowplow.ecommerce'
                  and event_version = '1-0-0'
              )
      
          
              
              and {{ snowplow_utils.is_run_with_new_events("ecommerce_transaction_interactions_features_1"
                  , new_event_limits_table="ecommerce_transaction_interactions_features_1_base_new_event_limits"
                  , incremental_manifest_table="ecommerce_transaction_interactions_features_1_incremental_manifest"
                  , base_sessions_lifecycle_table="ecommerce_transaction_interactions_features_1_base_sessions_lifecycle"
                  ) }}
      
      )
      
      select
          *,
          {{ dbt_utils.generate_surrogate_key(['entity_key', 'event_date']) }} AS entity_key_date_id
      from prep
      
          
  
    ''',
    'ecommerce_transaction_interactions_features_1/packages.yml': '''
      
      packages:
        - git: "https://github.com/snowplow/dbt-snowplow-utils.git"
          revision: "feature/aisp-489-bigquery-support"
  
    ''',
  })
# ---
